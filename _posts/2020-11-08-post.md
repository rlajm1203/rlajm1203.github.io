---
title: Information Security Overview - 5
date: 2020-11-08 01:24:00 -0400
---

# 정보보안 개론 5일~8일차
## 스니핑
스니핑이란 데이터 속에서 정보를 찾는 것을 말한다.
(네트워크 상에서 이동하는 패킷을 훔쳐보는 것과 동일)
- 스니핑의 원리

    네트워크 카드에는 랜카드에 들어오는 정보(IP주소, MAC주소)를 보고 저장할지 내보낼지 결정 하는데, 이때 IP주소와 MAC주소가 자신의 주소가 아니면 데이터를 거른다.
    이때 필터를 제거하면(데이터를 거르지 않는다는 말과 동일) 모든 데이터를 볼 수 있다면 스니핑에 성공한 것이다. 네트워크 계층에서의 랜카드의 필터링을 해제하는 모드를 프러미스큐어스(Promiscuous) 모드라고 한다.
    
- 스니핑의 공격 종류
    
    - 스위치 재밍 공격
    
        랜덤 형태로 생성한 MAC주소를 가진 패킷을 스위치에 무한대로 보내면 스위치 MAC 테이블이 자연스럽게 초과하고 스위치는 원래기능을 잃어 더미 허브처럼 작동한다.
        이러면 결국 스위치는 연결된 모든 포트로 플러딩을 하기 때문에 자신에게 쉽게 데이터가 오게된다.
        
    - SPAN 포트 태핑 공격
    
        SPAN은 스위치의 포트미러링 기능을 이용한 것이다. 포트미러링이란 각 포트에 전송되는 데이터를 미러링 하고 있는 포트에도 똑같이 보내는 것으로 침입탐지, 네트워크 모니터링
        , 로그시스템을 설치할 때 많이 사용한다.

- 스니핑의 공격 탐지

  스니퍼에대한 탐지는 프러미스큐어스 모드에서 작동한다는 데에서 시작하면 쉽다.
  
    - ping을 이용한 스니퍼 탐지
    
            대부분의 스니퍼는 일반 TCP/IP에서 동작하기 때문에 request를 받으면 response를 전달한다. 이때 의심스러운 호스트에 네트워크에 존재하지 않는 MAC주소로 Ping을 보내면 된다.
            만약 그 호스트가 스니퍼 호스트라면 ICMP echo reply를 보낼 것이고 아니면 보내지 않을 것이다. 정상 시스템이라면 위조된 MAC 주소의 Ping을 보냈을 때 자신이 대상이 아니므로
            ICMP 프로토콜이 작동한다.
        
    - ARP를 이용한 스니퍼 탐지
    
            Ping을 이용한 방시과 비슷하게, 위조된 ARP request를 보냈을 때 ARP response가 오면 프러미스큐어스 모드로 설정 돼 있는 것이다.
        
    - DNS를 이용한 스니퍼 탐지
    
            스니핑 프로그램은 사용자으 ㅣ편의를 위해 스니핑한 시스템의 IP주소에 DNS에 대한 이름해석 과정인 Reverse - DNS lookup을 수행한다. 이 방법은 원격과 로컬에서 모두 사용할 수 있으며,
            테스트 대상 네트워크로 Ping Sweep을 보내고 들어오는 Reverse - DNS lookup을 감시하여 스니퍼를 탐지한다.
        
    - 유인을 이용한 스니퍼 탐지
    
            공격자의 주요목적은 아이디와 패스워드 획득인 경우가 많다. 보안 관리자는 이 점을 이용해 가짜 아이디와 패스워드를 네트워크에 계속 뿌리고, 공격자가 이 아이디와 패스워드로
            접속을 시도할 때 스니퍼를 탐지한다.
        
    - ARP Watch를 이용한 스니퍼 탐지
    
            ARP Watch는 MAC주소와 IP주소의 매칭 값을 초기에 저장하고 ARP 트래픽을 모니터링하여 이를 변하게 하는 패킷이 있으면 관리자에게 메일로 알려주는 툴이다.
            대부분의 공격 기법은 위조된 ARP를 사용하므로 쉽게 탐지할 수 있다.

## 스푸핑
- 스푸핑 공격

스푸핑(Spoofing)의 사전적 의미는 '속이는 것'이다. 네트워크에서 스푸핑 공격의 대상은 MAC주소, IP주소, 포트 등 통신과 관련된 모든 것 일 수도 있다. 스푸핑 공격은 시스템 권한 얻기, 암호화된 세션 복호화하기, 네트워크 트래픽 흐름 바꾸기 등을 다양하게 사용한다.

- 스푸핑 공격의 종류

    - ARP 스푸핑 공격
    
            ARP 스푸핑은 MAC주소를 속이는 것이다. 로컬에서 통신하고 있는 서버와 클라이언트의 IP주소에 대한 데이터링크 계층의 MAC주소를 공격자의 MAC주소로 속여 데이터를 가로채는 방식이다.
            공격자가 양쪽에게 MAC주소를 포함한 패킷을 보내서 MAC주소 등록 정보를 수정해 정보를 가로챈다.
            ARP 스푸핑에 대한 대책은 ARP 테이블이 변경되지 않도록 arp -s [IP주소][MAC주소] 명령으로 고정하는 것이다.
            
    - IP 스푸핑 공격
    
            IP스푸핑은 IP주소를 속이는 것이로 다른 호스트의 IP를 강탈하여 어떤 권한을 획득하는 것이다.
            
            1. 신뢰관계를 맺는 서버와 클라이언트간의 연결을 끊는다. (Dos 나 DDos공격으로 끊으면 된다.)
            2. 공격자는 클라이언트의 IP를 알아내어 실제 클라이언트처럼 패스워드 없이 서버에 접근한다.
        
    - 트러스트 란?
    
            로그인을 할 때 클라이언트의 로그인 정보를 기록해 두고 합당한 클라이언트가 접근하면, 아이디와 패스워드의 입력없이 로그인을 하도록 하는 것이다.
            예를 들면 파티 주최자가 친분이 있는 사람을 경비에게 말하여 초대장이 없어도 들여 보내주는 것이랑 같다. 
            트러스트를 아예 사용하지 않거나 사용할 경우엔 보안성이 높은 패스워드를 설정해야한다.
            
    - ICMP 리다이렉트 공격
    
            ICMP 리다이렉트란 게이트워이가 2개일 때 다른 네트워크로 보내는 패킷을 두 게이트웨이 중 좀 더 효율적인 게이트웨이로 보내는 것을 말한다.
            호스트 A가 호스트 B로 패킷을 보내려고 할 땐 일단 라우터 A로 보내게 된다. 라우터 A는 패킷을 받으면 라우터 B에게 보내는 것이 좀 더 효율적이라고 판단되어
            라우터 B로 보내게 된다. ICMP 리다이렉트를 이용한 공격은 공격자가 라우터 B가 되는 것이다. 공격자가 호스트 A에게 ICMP 리다이렉트 패킷을 보내고 라우터 A에
            연결하면 모든 패킷을 스니핑 할 수 있다.
            
    - DNS 스푸핑 공격
    
            DNS 스푸핑은 실제 DNS서버보다 빨리 공격 대상에게 DNS response 패킷을 보내 공격 대상이 잘못된 IP주소로 웹 접속을 하도록 유도하는 공격이다.
            또한 DNS 패킷은 UDP 패킷이므로 세션이 없기 때문에 먼저 도착한 패킷을 신뢰하고 다음에 도착한 정보는 버린다. 공격자는 이러한 특징을 이용한다.
            
            공격자는 스위칭 환경일 경우 선행 작업, 플러딩 환경일 경우 선행 작업 없이 DNS 쿼리를 받을 수 있다. 이때 DNS 쿼리를 받고 클라이언트에게 DNS 서버보다 빨리 DNS Response를 보낸다.
            이때 클라이언트는 공격자가 보낸 패킷이 올바른 패킷이라고 생각하여 위조된 웹 서버로 접속한다.
            
            이러한 DNS 스푸핑을 막으려면 중요서버에 대해서 DNS 쿼리를 보내지 않으면 된다. DNS 쿼리는 hosts 파일에 URL 주소와 IP 주소가 제대로 대응되는지 확인하고 그 다음에 없으면 쿼리를
            보낸다. 따라서 중요 접속 서버의 URL에 대한 IP주소를 hosts파일에 등록해 놓으면 된다. 하지만 모든 서버의 IP를 등록하는 것은 무리이므로 모든 서버에 대한 DNS 스푸핑을 막기는 어렵다.
            
 ## 세션 하이재킹 공격
 
 세션 하이재킹이란 말 그대로 '세션 가로채기'를 뜻한다. 세션은 '사용자와 컴퓨터, 두 컴퓨터 간의 활성화 된 상태'이므로 두 시스템간의 연결이 활성화 된 상태, 즉 로그인 된 상태를 가로채는 것을
 말한다.
 
- TCP 세션 하이재킹

    TCP는 클라이언트와 서버 사이에 통신을 할 때 패킷의 연속성을 보장하기 위해 클라이언트와 서버에 각각 시퀀스 넘버를 이용한다.
    TCP 하이재킹은 잘못된 시퀀스 넘버를 사용해서 연결된 세션에 잠시 혼란을 준 뒤 자신이 끼어들어가는 방식을 사용한다.
    
    1. 클라이언트와 서버 사이의 패킷을 통제한다. ARP 스푸핑 등을 통해 클라이언트와 서버 사이의 통신 패킷 모두가 공격자를 지나게 해야한다.
    2. 서버에 클라이언트 주소로 연결을 재설정하기 위한 RST(Reset)패킷을 보낸다. 서버는 패킷을 받아 클라이언트의 시퀀스 넘버가 재설정된 것으로 판단하고 다시 TCP-3-웨이-핸드셰이킹을 수행한다.
    3. 공격자는 클라이언트 대신 연결되어 있던 TCP 연결을 그대로 물려받는다.
    
    이 세 단계를 거치면 공격자는 클라이언트가 텔넷 등을 통해 열어놓은 세션을 아이디와 패스워드의 입력 없이 그대로 획득할 수 있다.
    이러한 세션 하이재킹을막으려면 우선 텔넷과 같은 취약한 프로토콜을 이용해서는 안되고 SSH(Secure Shell)와 같이 세션에 대한 인증 수준이 높은 프로토콜을 이용하여 서버에 접속한다.
    
    또 다른 방법은 클라이언트와 서버 사이에 MAC 주소를 고정하는 것이다.MAC 주소를 고정하는 것은 ARP 스푸핑을 막아주기 때문에 결과적으로 세션 하이재킹을 막을 수 있다.
  
